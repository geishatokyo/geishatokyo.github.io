<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Geisha Tokyo Engineer's Blog</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link href="/static/css/style.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <style>
    .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .cm {
  color: #999988;
  font-style: italic;
}
.highlight .cp {
  color: #999999;
  font-weight: bold;
}
.highlight .c1 {
  color: #999988;
  font-style: italic;
}
.highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
.highlight .c, .highlight .cd {
  color: #999988;
  font-style: italic;
}
.highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}
.highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}
.highlight .ge {
  color: #000000;
  font-style: italic;
}
.highlight .gr {
  color: #aa0000;
}
.highlight .gh {
  color: #999999;
}
.highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .gt {
  color: #aa0000;
}
.highlight .kc {
  color: #000000;
  font-weight: bold;
}
.highlight .kd {
  color: #000000;
  font-weight: bold;
}
.highlight .kn {
  color: #000000;
  font-weight: bold;
}
.highlight .kp {
  color: #000000;
  font-weight: bold;
}
.highlight .kr {
  color: #000000;
  font-weight: bold;
}
.highlight .kt {
  color: #445588;
  font-weight: bold;
}
.highlight .k, .highlight .kv {
  color: #000000;
  font-weight: bold;
}
.highlight .mf {
  color: #009999;
}
.highlight .mh {
  color: #009999;
}
.highlight .il {
  color: #009999;
}
.highlight .mi {
  color: #009999;
}
.highlight .mo {
  color: #009999;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #009999;
}
.highlight .sb {
  color: #d14;
}
.highlight .sc {
  color: #d14;
}
.highlight .sd {
  color: #d14;
}
.highlight .s2 {
  color: #d14;
}
.highlight .se {
  color: #d14;
}
.highlight .sh {
  color: #d14;
}
.highlight .si {
  color: #d14;
}
.highlight .sx {
  color: #d14;
}
.highlight .sr {
  color: #009926;
}
.highlight .s1 {
  color: #d14;
}
.highlight .ss {
  color: #990073;
}
.highlight .s {
  color: #d14;
}
.highlight .na {
  color: #008080;
}
.highlight .bp {
  color: #999999;
}
.highlight .nb {
  color: #0086B3;
}
.highlight .nc {
  color: #445588;
  font-weight: bold;
}
.highlight .no {
  color: #008080;
}
.highlight .nd {
  color: #3c5d5d;
  font-weight: bold;
}
.highlight .ni {
  color: #800080;
}
.highlight .ne {
  color: #990000;
  font-weight: bold;
}
.highlight .nf {
  color: #990000;
  font-weight: bold;
}
.highlight .nl {
  color: #990000;
  font-weight: bold;
}
.highlight .nn {
  color: #555555;
}
.highlight .nt {
  color: #000080;
}
.highlight .vc {
  color: #008080;
}
.highlight .vg {
  color: #008080;
}
.highlight .vi {
  color: #008080;
}
.highlight .nv {
  color: #008080;
}
.highlight .ow {
  color: #000000;
  font-weight: bold;
}
.highlight .o {
  color: #000000;
  font-weight: bold;
}
.highlight .w {
  color: #bbbbbb;
}
.highlight {
  background-color: #f8f8f8;
}
    </style>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div id="navigation" class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../">Geisha Tokyo Engineer's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../rpscala.html">Scala勉強会</a>
            </li>
            <li><a href="http://www.geishatokyo.com" target="_blank">運営会社</a>
            </li>
            <li><a href="http://www.geishatokyo.com/#!/recruit.html" target="_blank">採用ページ</a>
            </li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
      <!-- /.container -->
    </nav>
    <div id="main" role="main">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
              <p>Page 2 of 3</p>
    <p><a href="../../">Previous page</a></p>

  <h1><a href="../../archives/2012/05/16/takezoux2.html">「これは絵文字ですか？」「はい、Unicode6.0です」</a></h1>
  <span>Posted on 2012-05-16
    by <a href="../../archives/authors/takezoux2.html">takezoux2</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>携帯向けのWebサービスをやっていく上で、絵文字の対応は頭を悩まされるところです。<br/>
最近では、ガラケーことFeaturePhoneに加えSmartPhoneも多く普及してきました。<br/>
そこで、現在の絵文字事情がどうなっているかを調べてみました。</p>

<h2>現在の絵文字の状況</h2>

<p>日本では、docomo, au, SoftBankの３キャリアごとにそれぞれ違った文字コードの絵文字が存在します。<br/>
世界に目を向けると、GoogleとAppleが主体となって絵文字の標準化を行なっており、<br/>
2010年10月に<a href="http://unicode.org/versions/Unicode6.0.0/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://unicode.org']);">Unicode6.0</a>で絵文字の国際標準が策定されました。<br/>
そのため、現在のスマートフォンを取り巻く絵文字事情は、docomo, au, SoftBank3キャリアの群雄割拠にUnicode6.0も参戦する太陽曰く(」・ω・)」うー!(/・ω・)/にゃーな状況となっています。<br/>
最近では、<a href="http://blog.yamk.net/yamk/archives/1675" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://blog.yamk.net']);">iOSが5.1になって他キャリアに絵文字が送れなくなった</a>なんてことも発生していました。</p>

<p>なお、Unicode6.0で採用された文字コード体系は、Googleの<a href="http://code.google.com/p/emoji4unicode/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://code.google.com']);">emoji4unicode</a>がベースになっています。</p>

<h2>絵文字の対応方法</h2>

<p>通常Webサービスなどで絵文字を保存する場合は、</p>

<ul>
<li>いずれかのキャリアの文字コードに変換</li>
<li>独自の形式に変換</li>
</ul>

<p>のどちらかを行ない、内部では１種類の絵文字コードで保存を行います。<br/>
日本ではdocomoユーザーが最も多いため、docomoの絵文字コードに統一して保存を行う場合が多いようです。<br/>
ちなみに、弊社の提供しているおみせやさんでは内部ではGoogle emoji4unicodeの下位16bitの文字コードに変換して保存をしています。(下位16bitはPUAなのでまず問題は起きません。詳しい説明は後述)</p>

<div style="text-align:center;">絵文字の変換フロー</div>

<p><img src="/static/images/2012/05/flow_emoji_conversion.png"/></p>

<h2>各機種絵文字対応状況</h2>

<p>現在の、スマートフォンの絵文字対応状況を紹介しておきます。<br/>
iPhoneのみが特殊で、OSのバージョンによって送信時の文字コードが違う＋表示はUnicode6.0とSoftBank共に出来る状態になっています。<br/>
表示確認は周りにおちてた機種のみでしかしていませんのであしからず。</p>

<table>
<tr>
<th>機種</th>
<th>OS</th>
<th>キャリア</th>
<th>入力時の文字コード</th>
<th>表示できる文字コード</th>
</tr>
<tr>
<td rowspan="2">iPhone4</td>
<td>iOS 4.X</td>
<td>SoftBank</td>
<td>SoftBank</td>
<td>Unicode6.0,SoftBank</td>
</tr>
<tr>
<td>iOS 5.X</td>
<td>SoftBank</td>
<td>Unicode6.0</td>
<td>Unicode6.0,SoftBank</td>
</tr>
<tr>
<td>iPhone4S</td>
<td>iOS 5.X</td>
<td>SoftBank</td>
<td>Unicode6.0</td>
<td>Unicode6.0,SoftBank</td>
</tr>
<tr>
<td>Sumsong Galaxy S2 LTE</td>
<td>Android 2.3</td>
<td>docomo</td>
<td>Google</td>
<td>docomo,Google</td>
</tr>
<tr>
<td>NEC Medias N06c</td>
<td>Android 2.3</td>
<td>docomo</td>
<td>Google</td>
<td>Google</td>
</tr>
<tr>
<td>Sharp Galapagos</td>
<td>Android 2.3</td>
<td>SoftBank</td>
<td>Google</td>
<td>SoftBank,Google</td>
</tr>
<tr>
<td>Sharp IS03</td>
<td>Android 2.2</td>
<td>au</td>
<td>Google</td>
<td>Google</td>
</tr>
</table>

<p>- 5/16 19:00 機種を追加＋間違っていた情報を修正</p>

<h2>スマートフォン時代の絵文字の取り扱い方は？</h2>

<p>既存のサービスを持っているところは現状維持が妥当とは思いますが、これから新規にサービスを立ち上げようとする場合はどのようにするのが良いでしょうか？</p>

<p>方法は、</p>

<ul>
<li>Unicode6.0標準をそのまま使用する</li>
<li>Unicode6.0標準の下位16bitを使う</li>
</ul>

<p>のどちらかかと思います。なるべくなら、前者をおすすめします。</p>

<h3>理由その1 すべての絵文字を網羅している</h3>

<p>3キャリアの絵文字では相互に変換できない絵文字が存在するため、どうしても特定のキャリアで使えない絵文字が出来てしまいます。<br/>
Unicode6.0であれば、３キャリアの絵文字 => Unicode6.0への変換はもれなく行うことができます。<br/>
またUnicode6.0 => 3キャリアの絵文字へは変換できない場合もありますが、絵文字の名前が定義されているので絵文字の変わりにその名前を表示することも可能です。</p>

<h3>理由その2 今後標準になっていく</h3>

<p>iOSはUnicode6.0での表示にすでに対応しています。MacでもUnicode6.0ならばそのまま絵文字が表示可能になっています。<br/>
WindowsPhoneも同様に徐々に対応してきているそうです。(実機では未確認。<a href="http://ja.wikipedia.org/wiki/%E6%90%BA%E5%B8%AF%E9%9B%BB%E8%A9%B1%E3%81%AE%E7%B5%B5%E6%96%87%E5%AD%97" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ja.wikipedia.org']);">wiki</a>から)<br/>
また、現在Androidは対応していませんがGoogleが標準化の主要メンバーであるので今後対応していってくれると思います。<br/>
なのでUnicode6.0にしておくと、将来的にキャリア別に絵文字の文字コードを変換をしなくても良くなる可能性が高いです。</p>

<h3>ただし・・・</h3>

<p>Unicode6.0の絵文字はU+1F200 ～　U+1F700台に多くがマップされています。これらのUnicodeはUTF-8でエンコードした場合4byte長になってしまいます。<br/>
現時点では、4byte長のUTF-8をうまく扱えないor扱うのが面倒なシステムが多く存在します。<br/>
例えば弊社ではMySQLを利用していますが、MySQLのUTF-8は4Byte長の文字を扱えません。MySQL5.5からは「utf8mb4」というCharacterSetが導入されたので4byte長も扱えるようになっていますが、それ以前のバージョンではBLOBを使ってバイナリとして保存をするしか方法がありませんでした。<br/>
また、最近はやりのNode.jsも、ベースになってるV8エンジンが4byte長UTF-8を扱えないため、文字列ではなくバイナリデータとして取り扱う必要があります。</p>

<p>このような事情から、現時点ではシステムによっては絵文字が含まれうる文字列は、バイナリデータとして無理やり使う必要があります。しかし、バイナリデータとしてしまうと、ライブラリ等に用意されている文字列関数が使えなくなってしまい取り扱いが面倒になることがあります。<br/>
そこで、下位の16bit分だけを利用するというのもひとつの解決策になります。下位16bitはU+F200 ～　U+F700台になり、これはUnicodeのPrivate Use Areaであるので、通常では他の文字とかぶっていません。そのため、下位16bitのみを使用しても問題になることはありません。ただし、入力時や表示時に変換が必須となるのでそのへんの手間を考えて、そのまま使うか下位16bitのみを使うかを決めたほうがいいと思います。</p>

<h2>参考にしたサイト</h2>

<p><a href="http://d.hatena.ne.jp/hhelibex/20120110/1326179698" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://d.hatena.ne.jp']);">MySQLで4バイトのUTF-8文字を扱ってみる</a><br/>
<a href="http://unicode.org/~scherer/emoji4unicode/snapshot/full.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://unicode.org']);">絵文字のUnicode6.0と各キャリアの対応表</a></p>

  <hr/>
  <h1><a href="../../archives/2012/03/01/yamauchi.html">Flash変換ライブラリ「Lightning」を公開しました</a></h1>
  <span>Posted on 2012-03-01
    by <a href="../../archives/authors/yamauchi.html">yamauchi</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>芸者東京の山内です。<br/>
弊社にて開発したPythonベースFlash変換ライブラリ「<strong>Lightning</strong>」をオープンソースで公開しました。<br/>
<a href="https://github.com/geishatokyo-lightning/lightning" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">lightning (github)</a><br/>
ライセンスはThe MIT Licenseです。</p>

<p>このライブラリは弊社アプリ「おみせやさん」のiPhone版で店やアバターを表現するのに使っています。<br/>
Flashで作成したswfファイルを、LightningによってiPhone用のWeb素材に変換します。</p>

<h2>Lightningのすごい所</h2>

<p><strong>1. 高い再現率</strong><br/>
SVGによるベクターグラフィックスと、CSS3-keyframeAnimationを組み合わせて利用し、再現率の高いアニメーションを実現しています。<br/>
swfとほぼ同等の見た目が再現できます。</p>

<p><strong>2. 滑らかなアニメーション</strong><br/>
例えば弊社アプリ「おみせやさん」の素材の内部パーツ点数は80-140程度でとても多く、既存のswf変換ライブラリはコマ落ちが発生してしまうのですが、LightningですとiPhone3GSの性能でも十分な速度でアニメーションを再生できます。<br/>
「おみせやさん」の10000種類ほどある素材に関してはアニメーション速度が遅れたり、コマ落ちしたりという現象は発生していません。</p>

<p><strong>3. 高速な動作</strong><br/>
iPhoneではcanvasを使った描画の場合、CPUの速度の関係で最新の機種でも15fps程度が限界となってしまいます。<br/>
しかし、Lightningによって生成されたアニメーションはGPUを使うように調整されているため、24fpsやそれ以上の滑らかなアニメーション表示が可能になります。<br/>
また、iPhoneへのデータは静的なSVG, CSSとして渡されているため、ほかのjavascriptを中心としたライブラリと違い、データ取得完了から描画開始までの待ち時間がありません。</p>

<p> </p>

<p><hr/> 
<h2>Lightningの使い方</h2>
<p>LightningはLinux環境での動作を想定しています。<br/>
Python&gt;=2.5,&lt;3.0がすでにインストールされているものとします。<br/>
以下の手順にしたがってリポジトリに入っているサンプルファイルを変換してみましょう。</p>
<p><strong>1. lightningのダウンロード</strong><br/>
githubからcloneします。<br/>
<code>git clone git://github.com/geishatokyo-lightning/lightning.git</code></p>
<p><strong>2. lightningのインストール</strong><br/>
<code>cd lightning &amp;&amp; python setup.py install</code></p>
<p><strong>3. サンプル実行</strong></p>
<p><strong> </strong><code>cd lightning<em>core/sample &amp;&amp; python xml2html.py sample1.xml sample1.html</code></p>
<p>同梱してあるサンプルファイルを変換します。sample1.html が生成されます。</p>
<p>iPhoneをターゲットとしているため、SafariまたはChromeでご確認ください。</p>
<p> </p>
<hr/> 
<h2>Demo</h2>
<p>SWFとlightningを並べてみました。<br/>
SafariかChromeで見てください。<br/>
Firefoxだと下記のサンプルが正常に表示されないようです(WordPressのinline htmlの問題っぽい)</p>
<p><strong>SWF</strong><br/>
&lt;object width=&ldquo;240&rdquo; height=&ldquo;240&rdquo; type=&ldquo;application/x-shockwave-flash&rdquo; data=&ldquo;/images/2012/03/lightning</em>avatar.swf&rdquo;&gt;<br/>
</object><br/>
<strong>Lightning</strong><br/>
<iframe style="width:320px;height:320px" src="/static/images/2012/03/lightning_avatar.html"/> </p>
<p><strong>使用上の注意</strong><br/>
Lightningでは、swfmillによってswf素材をxmlに変換する必要があります。<br/>
<a href="http://swfmill.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://swfmill.org']);">http://swfmill.org/</a> から swfmill をダウンロードしてインストールしましょう。（Linuxだけでなく、WindowsやMacにも対応しています。）<br/>
以下のコマンドでswfをswfmillでxmlに変換できます。<br/>
<code>swfmill swf2xml sample.swf sample.xml</code></p></p>

  <hr/>
  <h1><a href="../../archives/2012/01/26/y_okaya.html">今流行のArctic.jsと、enchant.jsの比較</a></h1>
  <span>Posted on 2012-01-26
    by <a href="../../archives/authors/y_okaya.html">y_okaya</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>こんにちは</p>

<p>ライセンス云々で話題になっていたArctic.jsですが、スマフォに特化したCanvas Frameworkということで<br/>
機能的にどうなのか、というところが大変気になります。弊社では同じゲーム向けのJSFrameworkとして、<br/>
enchant.jsを使用しているので機能をざっくり比較してみようと思います。</p>

<h2>機能の差</h2>

<table>
<thead>
<tr>
<th/>
<th>Arctic.js</th>
<th>enchant.js</th>
</tr>
</thead>
<tbody>
<tr>
<td>サイズ(byte)</td>
<td>90851</td>
<td>88593</td>
</tr>
<tr>
<td>圧縮後サイズ(byte)</td>
<td>36696</td>
<td>33570</td>
</tr>
<tr>
<td>オブジェクトの描画</td>
<td>canvas上</td>
<td>div毎</td>
</tr>
<tr>
<td>License</td>
<td>MIT</td>
<td>MIT or GPLv3</td>
</tr>
</tbody>
</table>

<p>圧縮後のファイルサイズはenchant.jsのほうが3kbほど少ないですね。<br/>
どちらもjs上に継承などを行う擬似クラスを作るためのClass要素があったり、スマートフォン/PC両方で使えるようにtouch系イベントとmouseDown/Move系イベントを判定したり、fps(フレーム数）を設定してフレーム毎のイベントを設定するなどしています。</p>

<p>Arctic.jsだけにある機能としては、Ajax対応（ただしJSONPはサポートしていないので、すべて同ドメインのサーバで処理する必要がある）、FLASHライクなタイムライン指定でのアニメーション機能があります。<br/>
反対に、enchant.jsだけにある機能としてはaudio要素への対応としてのSoundオブジェクト、RPGのフィールドマップのようなものを作るMapオブジェクト、あとはプロパティ型の記述ができるのが特徴でしょうか。</p>

<p><code>label.text = 'abc'; img.x=12; </code> と書くenchant.jsのほうが、<br/>
<code> labe.setText('abc'); img.setX(12); </code>とするArctic.jsよりも直感的ですよね。</p>

<p>後発だけあって、Arctic.jsのほうは<del>enchant.jsの機能をパクった</del>enchant.jsにある基本的な機能はだいたいあるような感じですね。</p>

<p>オブジェクトの描画についてですが、Canvasでの描画の方が性能的に有利かもしれませんが、enchant.jsは<br/>
divタグ毎にオブジェクトに持っていることで利便性をあげています。既存のアニメーション効果をdivタグ単位で<br/>
適応することにより、今までのエフェクトを使いまわすことができるのです。</p>

<p>enchant.jsと他のライブラリを合わせて使うサンプルは<a href="http://d.akiroom.com/2011-08/enchant-js-jquery-effects/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://d.akiroom.com']);">こちらのブログ</a>に具体的な実装方法が書かれていたので、実装方法はリンク先を御覧ください。</p>

<h2>スプライトするまでのコードの比較</h2>

<h3>Arctic.js</h3>
<pre class="highlight xml"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Test Sprite<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./arctic.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        var GameMain = arc.Class.create(arc.Game, {
            initialize:function(params) {
                var sp = new arc.display.Sprite(this._system.getImage('a.png'));
                sp.setX(10);
                sp.setY(10);
                this.addChild(sp);
            },
            update:function() {
            }
        });
        window.addEventListener('DOMContentLoaded', function(e){
            var system = new arc.System(320, 416, 'test');
            system.setGameClass(GameMain);
            system.load(['a.png']);
        }, false);
        <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">'test'</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre>

<h3>enchant.js</h3>
<pre class="highlight xml"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./enchant.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        enchant();
        window.onload = function() {
            var game = new Game(416,320);
            game.preload('a.png');
            game.onload = function() {
                var test = new Sprite(100,100);
                test.x = 10;
                test.y = 10;
                test.image = game.assets['a.png'];
                game.rootScene.addChild(test);
            };
            game.start();
        };
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre>

<p>どちらもオブジェクト指向的に書くようですが、enchant.jsの方がすっきり書けるようです。</p>

<p>ちなみにenchant.jsでもcanvasの描画機能が強化されるようです。<br/>
αブレンドもそのうちサポートされるとか。(詳細は<a href="http://wise9.jp/archives/6347" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wise9.jp']);">こちら</a>)</p>

<p>ぼちぼちスプライトの性能の差も比較していこうと思います。<br/>
それはまた別記事でっ！</p>

<p>追記：<br/>
無理にArctic.jsでスッキリ書くと、こんな感じでしょうか。</p>

<h3>Arctic.js</h3>
<pre class="highlight xml"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Test Sprite<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./arctic.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        window.onload = function(){
            var system = new arc.System(320, 416, 'test');
            system.setGameClass(arc.Class.create(arc.Game, {
                initialize:function(params) {
                    var sp = new arc.display.Sprite(this._system.getImage('a.png'));
                    sp.setX(10);
                    sp.setY(10);
                    this.addChild(sp);
                }
            }));
            system.load(['a.png']);
        }
        <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">'test'</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre>

<p>・・・ネスト多い。</p>
                            

  <hr/>
  <h1><a href="../../archives/2012/01/25/takezoux2.html">MavenからSBTへのビルド環境の移行</a></h1>
  <span>Posted on 2012-01-25
    by <a href="../../archives/authors/takezoux2.html">takezoux2</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>この記事は、sbt0.11.X系列の記事です。それ以前のバージョンでは正しく動作しません。</p>

<h2><a href="https://github.com/harrah/xsbt/wiki" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">SBT</a>とは</h2>

<p>Scala(とついでにJava)のためのビルドツールです。ちなみにSimple Build Toolの略です。<br/>
特徴としては、設定等全てscalaで書くことができ拡張性が高いビルドツールになっています。</p>

<p>この記事では、Mavenの主要な機能を順次sbtへと移植していきます。<br/>
現在ScalaをMavenと連携して使用しているけど、sbtも安定してきた気がするしsbtへ乗り換えてみようかなと思っている人達を対象にしています。<br/>
sbtに関しては、使う上での最低限の情報と、Mavenからの移植に必要な部分のみ触れています。<br/>
きちんとsbtの使い方を知りたい方は、本家のWikiを読んでください。</p>

<h2 id="index">目次</h2>

<h3><a href="http://blob.geishatokyo.com/?p=23169">SBTのセットアップ</a></h3>

<p><ul>
</ul><ol><a href="http://blob.geishatokyo.com/?p=23169#insall">1. SBTのインストール</a></ol>
<ol><a href="http://blob.geishatokyo.com/?p=23169#hello">2. Hello sbt</a></ol>
<ol><a href="http://blob.geishatokyo.com/?p=23169#overview">3. SBTの概要</a></ol></p>

<h3><a href="http://blob.geishatokyo.com/?p=97411">プロジェクトの準備</a></h3>

<p><ul>
</ul><ol><a href="http://blob.geishatokyo.com/?p=97411#make_project_file">1. SBTプロジェクトファイルの準備</a></ol>
<ol><a href="http://blob.geishatokyo.com/?p=97411#base_setting">2. 基本設定</a></ol></p>

<h3><a href="http://blob.geishatokyo.com/?p=101507">依存関係解決</a></h3>

<p><ul>
</ul><ol><a href="http://blob.geishatokyo.com/?p=101507#dependency">1. 依存関係の設定</a></ol>
<ol><a href="http://blob.geishatokyo.com/?p=101507#external_repo">2. 外部Repositoryの設定</a></ol>
<ol><a href="http://blob.geishatokyo.com/?p=101507#maven_local">3. MavenLocalRepositoryの設定</a></ol>
<ol><a href="http://blob.geishatokyo.com/?p=101507#global_setting">4. settings.xmlの置き換え</a></ol></p>

<h3>デプロイ</h3>

<p>Comming soon?</p>
                            

  <hr/>
  <h1><a href="../../archives/2012/01/18/kohashi.html">CSSのベンダープリフィックスを自動で追加するテクニックまとめ</a></h1>
  <span>Posted on 2012-01-18
    by <a href="../../archives/authors/kohashi.html">kohashi</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>こんにちわ！GTEエンジニアのkohashiです。</p>

<p>みなさん、CSS3してますか？CSS3によって表現は大幅に広がりましたが、一方で対応状況はブラウザによって様々…。<br/>
CSSでベンダープリフィックス(-mozとか、-webkitとか…)を複数記述するのはめんどくさいですよね？<br/>
というわけで、何とかしてくれる手法をまとめてみました。</p>

<h2>Prefixr</h2>

<p>Prefixr : <a href="http://prefixr.com/index.php" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://prefixr.com']);">http://prefixr.com/index.php</a><br/>
入力したCSSに、ベンダープリフィックスを付与してくれるWebサービスです。<br/>
こういうCSSを記述すると…</p>
<pre class="highlight css"><span class="nf">#test</span> <span class="p">{</span>
    <span class="nl">border</span><span class="p">:</span><span class="m">5px</span> <span class="m">#222</span> <span class="nb">solid</span><span class="p">;</span>
    <span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span>
    <span class="nl">transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
    <span class="nl">background</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span>  <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
    <span class="p">}</span>
</pre>

<p>こんな形に変換してくれます！</p>
<pre class="highlight css"><span class="nf">#test</span> <span class="p">{</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">5px</span> <span class="m">#222</span> <span class="nb">solid</span><span class="p">;</span>

    <span class="nl">-webkit-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="nl">-moz-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>

    <span class="nl">-webkit-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
    <span class="nl">-moz-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
    <span class="nl">-o-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
    <span class="nl">-ms-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
    <span class="nl">transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>

    <span class="nl">background</span><span class="p">:</span> <span class="n">-webkit-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
    <span class="nl">background</span><span class="p">:</span> <span class="n">-moz-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
    <span class="nl">background</span><span class="p">:</span> <span class="n">-o-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
    <span class="nl">background</span><span class="p">:</span> <span class="n">-ms-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
    <span class="nl">background</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
<span class="p">}</span>
</pre>

<p>また、Prefixrにはcssをワンライナーに圧縮する機能もついています。（”Compress My Code”のチェックを入れるだけ）<br/>
Webサービスでココまでやってくれるのは嬉しいですね。</p>

<p><a href="http://www.vim.org/scripts/script.php?script_id=3696" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.vim.org']);">vim用のプラグイン</a>も有るみたいなので、『CSSはvimで書く！』という人には良いですね。</p>

<h2>-prefix-my css</h2>

<p>-prefix-my css : <a href="http://prefixmycss.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://prefixmycss.com']);">http://prefixmycss.com/</a><br/>
Prefixrと同じような感じの、ウェブサービス型。</p>
<pre class="highlight css"><span class="nf">#test</span><span class="p">{</span>
<span class="nl">border</span><span class="p">:</span><span class="m">5px</span> <span class="m">#222</span> <span class="nb">solid</span><span class="p">;</span>
<span class="c">/*border-radius*/</span>
<span class="nl">-webkit-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span>
   <span class="nl">-moz-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span>
        <span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span>
<span class="c">/*transform*/</span>
<span class="nl">-webkit-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
   <span class="nl">-moz-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
    <span class="nl">-ms-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
     <span class="nl">-o-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
        <span class="nl">transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span><span class="n">5deg</span><span class="p">);</span>
<span class="c">/*linear-gradient*/</span>
<span class="nl">background</span><span class="p">:</span><span class="n">-webkit-gradient</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span><span class="nb">left</span> <span class="nb">top</span><span class="p">,</span><span class="nb">left</span> <span class="nb">bottom</span><span class="p">,</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#e1ffff</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#e1ffff</span><span class="p">,</span><span class="m">0.07</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#e1ffff</span><span class="p">,</span><span class="m">0.12</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#fdffff</span><span class="p">,</span><span class="m">0.12</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#e6f8fd</span><span class="p">,</span><span class="m">0.3</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#c8eefb</span><span class="p">,</span><span class="m">0.54</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#bee4f8</span><span class="p">,</span><span class="m">0.75</span><span class="p">),</span><span class="n">color-stop</span><span class="p">(</span><span class="m">#b1d8f5</span><span class="p">,</span><span class="m">1</span><span class="p">));</span>
<span class="nl">background</span><span class="p">:</span><span class="n">-webkit-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span>  <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
<span class="nl">background</span><span class="p">:</span>   <span class="n">-moz-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span>  <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
<span class="nl">background</span><span class="p">:</span>     <span class="n">-o-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span>  <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
<span class="nl">background</span><span class="p">:</span>        <span class="n">linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span>  <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
<span class="p">}</span>
</pre>

<p>インデント付けてくれるのでPrefixrと比べて見やすい方をお好みで、でしょうか。<br/>
※ background:-webkit-gradient の変換などに差異があり、-webkit-gradientのものはうまく動かないですね。</p>

<h2>-prefix-free</h2>

<p>-prefix-free : <a href="http://leaverou.github.com/prefixfree/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://leaverou.github.com']);">http://leaverou.github.com/prefixfree/</a><br/>
javascriptベースでCSSを書き換えてくれます。</p>
<pre class="highlight plaintext">&lt;script src="prefixfree.js"&gt;&lt;/script&gt;
</pre>

<p>このようにjsファイルを読み込むだけで、<style>～</style>で書いたcssや<link rel=”stylesheet” type=”text/css” />で読み込んだcss、DOMエレメントのstyle要素に記述したcssはもちろん、javascript経由で設定するcssまで適用してくれます！<br/>
ファイルサイズは5KBと軽量なうえ、jQuery等のライブラリに依存することもありません。</p>

<p>なによりすごいのは、javascript経由で設定したstyleまでベンダープリフィックスをつけた形で適用してくれること。<br/>
・・・もっとも、この機能はchromeとoperaで正常に動作しないそうです。<br/>
そのため、<a href="https://raw.github.com/LeaVerou/prefixfree/master/plugins/prefixfree.jquery.js" onclick="javascript:_gaq.push(['_trackEvent','download','http://raw.github.com/LeaVerou/prefixfree/master/plugins/prefixfree.jquery.js']);">-prefix-free の jQueryプラグイン</a>を導入して、<code> $('#obj').css('transform', 'rotate(30deg)') </code>などとするほうが良いようですね。</p>

<h2>compass</h2>

<p>compass: <a href="http://compass-style.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://compass-style.org']);">http://compass-style.org/</a><br/>
これが<strong>ベンダープリフィックス追加も含めた本命</strong>になると思います。</p>

<p>Rubyベースの、CSS構築フレームワークです。『CSSを生成するためのメタ記述が可能な言語』というところでしょうか。<br/>
同じシンプルな記述からCSSを生成することで有名な<a href="http://sass-lang.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://sass-lang.com']);">Sass</a>の拡張として作られています。<br/>
.scssというファイルに記述したCSSっぽい内容のものを、変換（コンパイル）して使います。<br/>
導入は、Rubyが導入されていれば簡単です。（winの人は適当に導入しておきましょう）</p>

<pre><code>
$ gem update --system
$ gem install compass
</code></pre>

<p>たったこれだけで導入完了！</p>

<p>■はじめて使う</p>

<pre><code>
## 基本ファイル作成
$ compass create
## 変更監視して、自動コンパイル
$ compass watch
</code></pre>

<p>■Railsプロジェクトに導入</p>

<pre><code>
$ rails new <myproject>
$ compass init rails <myproject>
</myproject></myproject></code></pre>

<p>先ほどと同じCSSを変換してみましょう。<br/>
<code>compass create</code> を実行して出来たファイル /sass/screen.scss を編集します。<br/>
記述がちょっと違うので注意が必要ですね。</p>
<pre class="highlight css"><span class="k">@import</span> <span class="s1">"compass/css3/"</span><span class="p">;</span>
<span class="nf">#test</span> <span class="p">{</span>
    <span class="nl">border</span><span class="p">:</span><span class="m">5px</span> <span class="m">#222</span> <span class="nb">solid</span><span class="p">;</span>
    <span class="err">@include</span> <span class="err">border-radius(10px);</span> <span class="c">/* 記述がだいぶ違うので注意です */</span>
    <span class="err">@include</span> <span class="err">skew(5deg,5deg);</span> <span class="c">/* "transform"が不要です */</span>
    <span class="err">@include</span> <span class="err">background(linear-gradient(top,</span>  <span class="err">#e1ffff</span> <span class="err">0%,#e1ffff</span> <span class="err">7%,#e1ffff</span> <span class="err">12%,#fdffff</span> <span class="err">12%,#e6f8fd</span> <span class="err">30%,#c8eefb</span> <span class="err">54%,#bee4f8</span> <span class="err">75%,#b1d8f5</span> <span class="err">100%));</span>
    <span class="p">}</span>
</pre>

<p>編集が終わったら、 <code>compass compile</code> です。</p>
<pre class="highlight css"><span class="k">@charset</span> <span class="s1">"Windows-31J"</span><span class="p">;</span>
<span class="c">/* line 3, ../sass/screen.scss */</span>
<span class="nf">#test</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">5px</span> <span class="m">#222</span> <span class="nb">solid</span><span class="p">;</span>
  <span class="nl">-moz-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">-webkit-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">-o-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">-ms-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">-khtml-border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="c">/* 記述がだいぶ違うので注意です */</span>
  <span class="nl">-moz-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span>
  <span class="nl">-webkit-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span>
  <span class="nl">-o-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span>
  <span class="nl">-ms-transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span>
  <span class="c">/* "transform"が不要です */</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">-webkit-gradient</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span> <span class="m">50</span><span class="err">%</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">50</span><span class="err">%</span> <span class="m">100</span><span class="err">%</span><span class="p">,</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">100</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span><span class="p">));</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">-webkit-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">-moz-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">-o-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">-ms-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span>
<span class="p">}</span>
</pre>

<p>出力結果もだいぶ違いますね！<br/>
普通にコンパイルすると、このcssは、.scssファイルの何行目か…という情報がコメントとしてついてきます。</p>

<p>なお、圧縮コンパイルするには <code>compass compile -s compressed sass/*</code> を使います。</p>
<pre class="highlight css"><span class="nf">#test</span><span class="p">{</span><span class="nl">border</span><span class="p">:</span><span class="m">5px</span> <span class="m">#222</span> <span class="nb">solid</span><span class="p">;</span><span class="nl">-moz-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">-webkit-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">-o-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">-ms-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">-khtml-border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">border-radius</span><span class="p">:</span><span class="m">10px</span><span class="p">;</span><span class="nl">-moz-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span><span class="nl">-webkit-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span><span class="nl">-o-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span><span class="nl">-ms-transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span><span class="nl">transform</span><span class="p">:</span><span class="n">skew</span><span class="p">(</span><span class="n">5deg</span><span class="p">,</span> <span class="n">5deg</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">-webkit-gradient</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span> <span class="m">50</span><span class="err">%</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">50</span><span class="err">%</span> <span class="m">100</span><span class="err">%</span><span class="p">,</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">0</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">7</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#e1ffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">12</span><span class="err">%</span><span class="p">,</span> <span class="m">#fdffff</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">30</span><span class="err">%</span><span class="p">,</span> <span class="m">#e6f8fd</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">54</span><span class="err">%</span><span class="p">,</span> <span class="m">#c8eefb</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">75</span><span class="err">%</span><span class="p">,</span> <span class="m">#bee4f8</span><span class="p">),</span> <span class="n">color-stop</span><span class="p">(</span><span class="m">100</span><span class="err">%</span><span class="p">,</span> <span class="m">#b1d8f5</span><span class="p">));</span><span class="nl">background</span><span class="p">:</span><span class="n">-webkit-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">-moz-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">-o-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">-ms-linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">);</span><span class="nl">background</span><span class="p">:</span><span class="n">linear-gradient</span><span class="p">(</span><span class="nb">top</span><span class="p">,</span> <span class="m">#e1ffff</span> <span class="m">0</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">7</span><span class="err">%</span><span class="p">,</span><span class="m">#e1ffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#fdffff</span> <span class="m">12</span><span class="err">%</span><span class="p">,</span><span class="m">#e6f8fd</span> <span class="m">30</span><span class="err">%</span><span class="p">,</span><span class="m">#c8eefb</span> <span class="m">54</span><span class="err">%</span><span class="p">,</span><span class="m">#bee4f8</span> <span class="m">75</span><span class="err">%</span><span class="p">,</span><span class="m">#b1d8f5</span> <span class="m">100</span><span class="err">%</span><span class="p">)}</span>
</pre>

<p>compassには、css3のレイアウトフレームワーク：Blueprintが使えたり、変数などを使ってcssを記述できるscss記法が使えたりと色々高機能ですね！<br/>
compass watch を使えば、毎回コンパイルする必要なくファイル変更時に自動コンパイルしてくれるのも、開発効率が上がりそうで良い感じです。</p>

<p>また、コマンドラインが面倒くさい！という人のために、アプリ版がオススメ。<br/>
<a href="http://mhs.github.com/scout-app/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://mhs.github.com']);">http://mhs.github.com/scout-app/</a><br/>
こちらはwin版/Mac版があり、Ruby実行環境も不要！<br/>
デザイナーさん向けにはこちらが良いかもしれませんね。</p>

  <hr/>
  <h1><a href="../../archives/2011/12/26/y_okaya.html">Play frameworkで動的にリンクを作る(for scala)</a></h1>
  <span>Posted on 2011-12-26
    by <a href="../../archives/authors/y_okaya.html">y_okaya</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>こんにちは。GTEエソヅニアの岡谷です。</p>

<p>クリスマスはPlay framework(Ver1.2.4)とアツい夜を過ごしたので、その時得た<br/>
Tipsをご紹介します。弊社ではScalaが最大勢力のメジャー言語なので、Play frameworkでも<br/>
scalaを使ってみようと検証中です。</p>

<p>動的にリンクを作りたいケースがあり、テンプレートに実装していたのですが、Java版で書くと<br/>
下記のようなことをScala版でもしようとしました。</p>
<pre class="highlight html">　<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"@{Application.show(_post.id)}"</span><span class="nt">&gt;&lt;span&gt;</span>link<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</pre>

<p>参考URL：<a href="http://www.playframework.org/documentation/1.0.1/guide4" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.playframework.org']);">Playframework  tutorial(Java)</a></p>

<p>このコードはJava版とScala版のリファレンスを見ると、Scala版にはサンプルコードがないのですが、<br/>
見る限りそのまんま使えそうに見えます。</p>

<p>参考URL：<a href="http://scala.playframework.org/documentation/scala-0.9.1/templates" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://scala.playframework.org']);">Scala templates</a></p>

<p>しかしながら、Scala版でそのまんま使おうとしたところ使えませんでした。<br/>
Application.showのリンク先がこのコードの部分でレンダリングされてしまうのです。</p>

<p>あれー、と思ってplay-scalaのソースをまさぐってみたら下記のコードを見つけました。</p>

<p>views.object in ScalaTemplate.scala</p>
<pre class="highlight scala">        <span class="k">def</span> <span class="n">a</span><span class="o">(</span><span class="n">action</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Any</span><span class="o">)(</span><span class="n">body</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Html</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Html</span> <span class="o">{</span>
            <span class="k">var</span> <span class="n">actionDef</span> <span class="k">=</span> <span class="k">new</span> <span class="n">play</span><span class="o">.</span><span class="n">mvc</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="nc">ScalaAction</span><span class="o">(</span><span class="n">action</span><span class="o">).</span><span class="n">actionDefinition</span>
            <span class="k">if</span><span class="o">(</span><span class="n">actionDef</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"GET"</span><span class="o">)</span> <span class="o">{</span>
                <span class="s">"""&lt;a href=""""</span> <span class="o">+</span> <span class="n">actionDef</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s">""""&gt;"""</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s">"""&lt;/a&gt;"""</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">val</span> <span class="n">uuid</span> <span class="k">=</span> <span class="n">play</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="nc">Codec</span><span class="o">.</span><span class="nc">UUID</span>
                <span class="s">"""&lt;a href="javascript:document.getElementById('"""</span> <span class="o">+</span> <span class="n">uuid</span> <span class="o">+</span> <span class="s">"""').submit()"&gt;"""</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s">"""&lt;/a&gt;&lt;form id=""""</span> <span class="o">+</span> <span class="n">uuid</span> <span class="o">+</span> <span class="s">"""" action=""""</span> <span class="o">+</span> <span class="n">actionDef</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s">"""" method=""""</span> <span class="o">+</span> <span class="n">actionDef</span><span class="o">.</span><span class="n">method</span> <span class="o">+</span> <span class="s">""""&gt;&lt;/form&gt;"""</span>
            <span class="o">}</span>
        <span class="o">}</span>
</pre>

<p>この機能を使えばうまくいきそうです。<br/>
書いてみるとこんな感じですね。</p>
<pre class="highlight html">  @a(Application.show(_post.id)){
    <span class="nt">&lt;span&gt;</span>link<span class="nt">&lt;/span&gt;</span>
  }
</pre>

<p>動かしてみるときちんと動きました。</p>

<p>以上、Play framework(for scala)で動的リンクを作るためのちょっとしたTipsでした。</p>
                            

  <hr/>
  <h1><a href="../../archives/2011/10/26/g_enrique.html">NoClassDefFoundError:scala/Serializable when using multiple versions of Scala</a></h1>
  <span>Posted on 2011-10-26
    by <a href="../../archives/authors/g_enrique.html">g_enrique</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>This is esaulgd, application engineer at Geisha Tokyo.</p>

<p>A while ago, I was working on a web app developed with Scalatra and Maven. Suddenly, the following error started to pop up anytime I tried to build: (edited for brevity)</p>
<pre class="highlight scala"><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">NoClassDefFoundError</span><span class="k">:</span> <span class="kt">scala/Serializable</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">ClassLoader</span><span class="o">.</span><span class="n">defineClass1</span><span class="o">(</span><span class="nc">Native</span> <span class="nc">Method</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">ClassLoader</span><span class="o">.</span><span class="n">defineClassCond</span><span class="o">(</span><span class="nc">ClassLoader</span><span class="o">.</span><span class="n">java</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">ClassLoader</span><span class="o">.</span><span class="n">defineClass</span><span class="o">(</span><span class="nc">ClassLoader</span><span class="o">.</span><span class="n">java</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="nc">SecureClassLoader</span><span class="o">.</span><span class="n">defineClass</span><span class="o">(</span><span class="nc">SecureClassLoader</span><span class="o">.</span><span class="n">java</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URLClassLoader</span><span class="o">.</span><span class="n">defineClass</span><span class="o">(</span><span class="nc">URLClassLoader</span><span class="o">.</span><span class="n">java</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URLClassLoader</span><span class="o">.</span><span class="n">access$000</span><span class="o">(</span><span class="nc">URLClassLoader</span><span class="o">.</span><span class="n">java</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URLClassLoader$1</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">URLClassLoader</span><span class="o">.</span><span class="n">java</span><span class="o">)</span>
</pre>

<p>A Google search turned up no easily identifiable cause. Most people with similar problems found them to be related to building Lift, so I wondered whether there was an analogous issue with Scalatra. Just when it looked like I would have to roll up my sleeves and start messing with the build process, I found <a href="http://d.hatena.ne.jp/egghour/20110602/1306975302" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://d.hatena.ne.jp']);">this article written in Japanese</a>.</p>

<p>The article places the blame on simultaneous usage of multiple versions of Scala. When I checked, indeed there it was on the log output:</p>
<pre class="highlight scala"><span class="o">[</span><span class="kt">WARNING</span><span class="o">]</span> <span class="nc">Multiple</span> <span class="n">versions</span> <span class="n">of</span> <span class="n">scala</span> <span class="n">libraries</span> <span class="n">detected</span><span class="o">!</span>
</pre>

<p>The reason I hadn’t made the connection is that this particular warning had been sitting there for months without any ill consequences. Well, until now.</p>

<p>As the problem had roots in the dependency chain deeper than the component I was in charge of, I brought the project lead into the fold. After some deliberation, we decided to make everything rely on the then-current Scala 2.9.0.</p>

<p>The “easy” part was to make sure that the web app, and all internally-developed upstream components, compiled using 2.9.0. In most cases this was as simple as editing the pom.xml as shown below and recompiling.</p>
<pre class="highlight xml">  <span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
-      <span class="nt">&lt;scala.version&gt;</span>2.8.1<span class="nt">&lt;/scala.version&gt;</span>
+      <span class="nt">&lt;scala.version&gt;</span>2.9.0<span class="nt">&lt;/scala.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.scala-lang<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>scala-library<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${scala.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.scala-lang<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>scala-compiler<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${scala.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;/project&gt;</span>
</pre>

<p>For externally-made components where a version for Scala 2.9 was available, we updated the dependency info. When this was not the case, for example with Scalatra (scalatra_2.8.1 ver 2.0.0.M3 at the time), we deployed a custom build to our internal repository.</p>
<pre class="highlight xml"><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>
  <span class="nt">&lt;properties&gt;</span>
-   <span class="nt">&lt;scalatra.version&gt;</span>2.0.0.M3<span class="nt">&lt;/scalatra.version&gt;</span>
+   <span class="nt">&lt;scalatra.version&gt;</span>2.0.0-SNAPSHOT<span class="nt">&lt;/scalatra.version&gt;</span>
    <span class="nt">&lt;scala.version&gt;</span>2.9.0<span class="nt">&lt;/scala.version&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.scalatra<span class="nt">&lt;/groupId&gt;</span>
-     <span class="nt">&lt;artifactId&gt;</span>scalatra_2.8.1<span class="nt">&lt;/artifactId&gt;</span>
+     <span class="nt">&lt;artifactId&gt;</span>scalatra_${scala.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${scalatra.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.scalatra<span class="nt">&lt;/groupId&gt;</span>
-     <span class="nt">&lt;artifactId&gt;</span>scalatra-scalate_2.8.1<span class="nt">&lt;/artifactId&gt;</span>
+     <span class="nt">&lt;artifactId&gt;</span>scalatra-scalate_${scala.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${scalatra.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.scalatra<span class="nt">&lt;/groupId&gt;</span>
-     <span class="nt">&lt;artifactId&gt;</span>scalatra-scalatest_2.8.1<span class="nt">&lt;/artifactId&gt;</span>
+     <span class="nt">&lt;artifactId&gt;</span>scalatra-scalatest_${scala.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${scalatra.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre>

<p>Once the entire chain was updated, both the warning and the error disappeared.</p>

<p>A possible explanation for this phenomenon <a href="http://stackoverflow.com/questions/4955055/scala-question-about-examples-in-programming-scala-book" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://stackoverflow.com']);">lies with the compiler daemon</a>. However, the Maven build wasn’t supposed to be using the daemon in the first place, so either there’s a fault there or another factor is at play.</p>

<p>In any case, having this information spelled out in English will hopefully help someone else.</p>

<p>Good luck and happy scala-ing!</p>

  <hr/>
  <h1><a href="../../archives/2011/10/25/kohashi.html">スマートフォンサイトでiframeを使い、「戻る」とリダイレクトが再実行される問題の対応</a></h1>
  <span>Posted on 2011-10-25
    by <a href="../../archives/authors/kohashi.html">kohashi</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>こんにちわ。GTEエンジニアのkohashiです。</p>

<p>webアプリエンジニアであれば少なからず、サーバー側の処理結果によって、 302  Moved Temporarily で遷移先を振り分けする機会があると思います。<br />
ASP.netであれば Response.Redirect(&ldquo;test.aspx&rdquo;); を使いますね。( Server.Transferメソッドはちょっと処理が違います）<br />
phpであれば header(&ldquo;Location: test.php&rdquo;); でしょうか。</p>

<p><img src="/static/images/2011/10/index.png"/></a></p>

<p>芸者東京では、たとえばゲームアプリ内の「かいもの」機能でこの振り分けを使っています。<br />
「購入」ボタンを押すと、所持金額をチェックしてOKならば「購入完了！」ページへ、所持金額が少ない場合などは「お金が足りません」ページへ振り分けるんですね。</p>

<p>さて、このような 302 Redirectを、Android/iPhone などで、iframeの中で使うとちょっとした問題が起きます。</p>

<p>なんと、Backボタンを押すと、リダイレクト結果のページではなく、リダイレクト元ページに飛ぶのです！</p>

<p><img src="/static/images/2011/10/index1.png"/></p>

<p>この現象はiOS3/4と、Android2.&frac12;.2で確認しました。<br />
※ PCブラウザはもちろん、スマートフォンでもiframe内で行わない限り、戻るボタンはリダイレクト結果のページに遷移するだけです。</p>

<p>これは、つまりBackボタンを押すと、ユーザが意図せず買い物をしてしまう、ということです。</p>

<p>iframeを使うスマートフォン向けwebサイトは少ないとはいえ、iframeを使う場合にはちょっとした大問題ですね。</p>

<p>というわけで修正コードですが、こちらになります。</p>
<pre class="highlight javascript">    <span class="k">if</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">referrer</span> <span class="o">!=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">){</span>
       <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
    <span class="p">}</span>
</pre>

<p>簡単ですね。<br />
なお、この事象ですがiOS5では発生しなくなっているようです。<br />
mobile safari のバージョンがあがったからでしょうか？</p>

<p>※ちなみに、このシーケンス図は <a href="http://www.websequencediagrams.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.websequencediagrams.com']);">http://www.websequencediagrams.com/ </a>で作りました！<br />
基本英語サイトですが、日本語の入力もOK（フォントの種類が少なくなってしまいますが）ですし、テキストからシーケンス図などが作れるのは素敵ですよね。</p>

  <hr/>
  <h1><a href="../../archives/2011/10/14/h_ninomiya.html">NFC業界の基礎知識</a></h1>
  <span>Posted on 2011-10-14
    by <a href="../../archives/authors/h_ninomiya.html">h_ninomiya</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>初めまして、こんにちは。GTEインターン生の二宮と申します。今回は私、二宮が個人的に興味のあるFeliCa についてお話ししたいと思います。</p>

<p>流れとしては、まずはFeliCa周りの基礎知識を紹介し、それからFeliCaの識別番号を取得するような簡単なプログラムを組んでみます。記事を通じて、FeliCa / NFCを取り巻くドキドキ感を読者の方にお伝えできれば幸いです。</p>

<h2>1.FeliCaってなぁに？</h2>

<p>そもそも皆さん、FeliCa をご存知でしょうか。……おっしゃる通り、SuicaやらWAONやらに使われているソニーの技術方式ですね。この名前は英語で「至福」を意味するfelicityからきています。</p>

<p>どうしても「FeliCa = カード型」のイメージが拭えませんが(<em>*1</em>)FeliCa技術そのものは通信インタフェースとOSを指します。ですから、別にカード型である必要はなく、実際アジアではコイン型のFeliCaトークンが使われていたりもします。</p>

<p>また、おサイフケータイ機能に使われているモバイルFeliCaや、FeliCa Plugを使用した健康機器など(個人的にはあまり馴染みがありませんが……)もカード型じゃありませんよね。</p>

<p>また、FeliCaの基本はリーダ／ライタから給電された上で駆動するので比較的シンプルな事しかできないのですが、モバイルFeliCaやFeliCa Plugでは、これらを搭載したデバイスと連携していろいろ面白いことができるようですよ。</p>

<p>例として、モバイルFeliCaには「カードエミュレーション」「P2P」「リーダ・ライタ」の3つのモードがあります。「カードエミュレーション」以外のモードを意識されていない方も多いのではないでしょうか。私も先日のFeliCaソリューションセミナー2011において、受付証(FeliCa)をAndroid端末で認証された時は「おおっ！」ってなりました。このあたりの技術は今からお話しするNFCとの関連性含めて、今後熱くなっていくんじゃないのかなぁとか思う私なのです。</p>

<div><img src="/static/images/2011/10/mobileFelicaMode.png" alt="モバイルFeliCaのモード" title="mobileFelicaMode" /><p class="wp-caption-text">モバイルFeliCaのモード</p></div>

<h2>2.RFID やNFC とFeliCa の関係</h2>

<p>さて、FeliCaといえば、関連してRFIDだとかNFCだとかいうワードを思い浮かべる方もあるかもしれません。結論から言うと、FeliCa はRFID 技術の一例ですし、NFC の一種でもあります。</p>

<p>まず、RFIDの方からいきましょう。こちらはRadio Frequency IDentification、つまり無線個体識別のことですね。歴史的にはバーコードの系譜から分かれてきたみたいで、最初はバーコードの代替として使われていました。バーコードと違ってタグが隠れていても情報を読み取ることができて便利なのが良かったみたいですね。</p>

<p>そこから、タグの情報を書き換えられたり、持てる情報量が多かったりするRFIDタグの特性を利用して、商品情報そのものを書き込んだり、一つ一つの商品を識別したりするのに使われるようになりました。ですからRFIDというと割と物流方面で使われているイメージがありますね。</p>

<p>あとは、農場での家畜の管理や万引き防止で使われるEAS(Electronic Article Surveillance)(<em>*2</em>)の一部でもRFID技術が使われています。</p>

<p>そのRFID というくくりの内にカード型（人用）というジャンルがあり、さらにその中には通信距離に応じた3つのタイプ(密着型：～数mm、近接型：～10cm、近傍型：～70cm)がありました。世間一般で非接触ICカードと呼ばれるもの殆どは3つの内の近傍型(ISO/IEC 14443で標準化)に分類されます。もしかしたら、TypeA、TypeBという規格名を耳にしたことがあるかもしれませんが、これらはISO/IEC 14443内の区分けを指しているのです(<em>*3</em>)。</p>

<p>実はFeliCaもISO/IEC 14443のTypeCとして、国際規格化を目指していました。しかし、審議の時間切れのために却下されてしまいます。</p>

<p>どうしてもFeliCaを国際規格にしたい、とソニーが思ったのかは定かでありませんが、その後ソニーはフィリップスとFeliCaやMIFAREと下位互換性のある規格を共同開発し、標準化を目指します。そうして2003年末に国際規格として認められたのがISO/IEC 18092で、これが俗にいうNFC(Near Field Communication)です。NFCの規格は後に、TypeBやISO/IEC 15693（カード型RFIDの近傍型の規格）を含むように拡張されており、ISO/IEC 21481として標準化されています。ですから、現在NFCといえばカード型RFIDのうち、近接型、近傍型をカバーした上にFeliCaも取り扱える規格ということができます。</p>

<div><img src="/static/images/2011/10/nfc.png" alt="NFC内でのFeliCaの位置づけ" /><p class="wp-caption-text">NFC内でのFeliCaの位置づけ</p></div>

<p>モバイル国内独自機能の代表格、おサイフケータイ(モバイルFeliCa)のイメージが強いのでしょう、よく「FeliCa vs NFC」なんていう構図を見かけますが、正確にはFeliCaはNFCの一端を担っているため対立するものではありません。</p>

<p>参考：<a href="http://www.atmarkit.co.jp/frfid/special/5minic/01.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.atmarkit.co.jp']);">http://www.atmarkit.co.jp/frfid/special/5minic/01.html</a> / <a href="http://www.welcat.co.jp/knowledge/rfid/rfid003.php" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.welcat.co.jp']);">http://www.welcat.co.jp/knowledge/rfid/rfid003.php</a></p>

<h2>3.作成するプログラム</h2>

<p>やたらと前置きが長くなってしまいましたが、作成するプログラムはシンプルです。FeliCa一枚一枚に振られている識別番号(IDm)を取得してみます。FeliCaカードはリーダ・ライタからPollingコマンドが来たらその応答としてこのIDmを返すようになっています(<em>*4</em>)。その仕掛けを利用してカードに対してPollingコマンドだけを発信し、応答として得られたIDmを表示してみましょう。</p>

<p>開発ソフトはVisual C# 2010 Expressを使用します。SDKはSDK for FeliCa(<em>*5</em>)という本格的なものもありますが、こちらは入手が難しいため、有志が作成した<a href="http://felicalib.tmurakam.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://felicalib.tmurakam.org']);">felicalib</a>というものを利用します。今回はハードウェアとしてこのほかにリーダ・ライタ(<a href="http://www.amazon.co.jp/gp/product/B0047AHHD2/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.amazon.co.jp']);">このあたり</a>)が必要となりますので適宜準備のほどよろしくお願いします。</p>

<p>さて、プロジェクトをコンソールアプリケーションとして新規作成し、コードを以下のように書いてみます。</p>
<pre class="highlight csharp"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">FelicaLib</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FeliCaTest</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Felica</span> <span class="n">_felica</span><span class="p">;</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">_felica</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Felica</span><span class="p">();</span>
                <span class="n">_felica</span><span class="p">.</span><span class="nf">Polling</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="m">0xffff</span><span class="p">);</span>

                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"IDm : "</span> <span class="p">+</span> <span class="nf">BitConverter</span><span class="p">(</span><span class="n">_felica</span><span class="p">.</span><span class="nf">IDm</span><span class="p">()));</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"例外発生 - "</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>

<p>正直、説明するところがなくて困っています。そのくらいにシンプルですね。Pollingメソッドの引数は、システムコード(<em>*6</em>)という値を指しますが、深く気にする必要はありません。ここでは、どんなFeliCaでも反応するような値を入れています。</p>

<p>あ、felicalibのC#ライブラリを関連付けるのと、実行時にfelicalib.dllを探せる位置に置いておくことをお忘れなく。</p>

<div><img src="/static/images/2011/10/FelicaResult.png" alt="実行結果" title="FelicaResult" /><p class="wp-caption-text">実行結果</p></div>

<p>ここから工夫していく点としては、Pollingコマンドの発信部分をループにしてカード補足時のみイベントを発生させるようにモジュール化する、といったところでしょうか。</p>

<p>このようにFeliCaからIDmを読むこと自体は非常に簡単にできますが、データベースやネットワークと連携させれば、なかなか面白いことができると思います。<br />
是非お試しあれ。</p>

<h2>脚注</h2>

<ol>
<li>FeliCaの公式ページにも「ソニーの非接触ICカード技術方式」だなんて書いてありますしね &ldquo; <a href="http://www.sony.co.jp/Products/felica/about/index.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sony.co.jp']);">http://www.sony.co.jp/Products/felica/about/index.html</a></li>
<li>タグにIDがない、つまり個体識別していなかったら定義から外れるため、正確にはRFIDではありません。</li>
<li>TypeAはオランダのフィリップス社(現：NXPセミコンダクターズ)が開発したもので、MIFAREとも呼ばれます。世界で最も普及しており、日本ではtaspo(タスポ)などがこの規格を使っています。TypeBは、モトローラ社が開発を主導したもので、日本の運転免許証、パスポートに採用されています。</li>
<li>通信プロトコルやファイルシステム、コマンドシーケンスなどFeliCaの細かい技術仕様は公式サイトで入手することができます。 &rdquo; <a href="http://www.sony.co.jp/Products/felica/business/tech-support/index.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.sony.co.jp']);">http://www.sony.co.jp/Products/felica/business/tech-support/index.html</a></li>
<li>「FeliCaもNFCなんだぜ！」ということをアピールするために、近々「SDK for NFC」に改称するとか何とか。</li>
<li>他のシステムコードの例としては、nanaco やWAON が使用している共通領域を表す0xfe00やSuica やPASMO が使用しているサイバネ領域を表す0x0003などがあります。</li>
</ol>

  <hr/>
  <h1><a href="../../archives/2011/10/11/arikui.html">mavenによるAndroidプロジェクトのProfile設定</a></h1>
  <span>Posted on 2011-10-11
    by <a href="../../archives/authors/arikui.html">arikui</a>
  </span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>初めまして、arikuiと言います。先月くらいからAndroid向けアプリ開発を担当しています。<br/>
今回はAndroid開発において環境に依存するリソースの切り替え方法、中でもmavenのプロファイルについて書きたいと思います。</p>

<p><strong>使用した開発環境</strong></p>

<ul>
<li>maven2</li>
<li>maven-android-plugin 2.8.4</li>
<li>android SDK 2.2</li>
<li>(Eclipse 3.6 Helios)</li>
</ul>

<p>私の環境ではmavenを使用してAndroid開発をしているので、やや限定された環境向けの記事かもしれません。<br/>
まだ私自身あれこれ試行錯誤している部分もあるので、他にもっといい方法があるかもしれませんがそこはご了承ください。</p>

<h2>maven-android-pluginの設定</h2>

<p>弊社では、mavenで設定を切り替える場合にはpom.xmlやprofiles.xml、settings.xmlでプロファイルごとにリソースディレクトリを変数定義して切り替える方法をよく採用しています。<br/>
Androidプロジェクトではリソースはresディレクトリ以下に配置していきます。Androidプロジェクトにおけるリソースとは、コード以外の全てのファイルであり、リソースの種類によってディレクトリが決まっています。<br/>
<a href="http://developer.android.com/guide/topics/resources/available-resources.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://developer.android.com']);">Resource Types</a></p>

<p>このresディレクトリを切り替えればいいわけです。<br/>
そのためにmaven-android-pluginの要素の子要素として、以下が用意されています。</p>

<p><strong>resourceDirectory</strong><br/>
リソースを配置するディレクトリ。デフォルトは${project.basedir}/res<br/>
<strong>resourceOverlayDirectory</strong><br/>
リソースディレクトリに上書きする差分ディレクトリ。デフォルトは${project.basedir}/res-overlay<br/>
同じ名前のファイルがあれば上書きし、違う名前のファイルがあればコピーする。差分だけを置けばよい。<br/>
<strong>resourceOverlayDirectories</strong><br/>
上書きするディレクトリを<dir>要素で複数設定可能。こちらを設定した場合、<resourceOverlayDirectory>要素は無視される。<br/>
同じ名前が競合した場合は、先に設定した方が優先される。</p>

<p>その他の要素は以下を参照してください。<br/>
<a href="http://maven-android-plugin-m2site.googlecode.com/svn/apk-mojo.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://maven-android-plugin-m2site.googlecode.com']);">android-maven-plugin</a></p>

<p><resourceDirectory>要素で設定したディレクトリには全てのプロファイルで共通のリソースを入れておきます。そして<resourceOverlayDirectory>もしくは<resourceOverlayDirectories>要素で設定したディレクトリにはプロファイルごとに異なるリソースを入れます。</p>

<h2>設定例</h2>

<p><strong>実際に設定したpom.xml</strong></p>
<pre class="highlight xml"><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.jayway.maven.plugins.android.generation2<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-android-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.8.4<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;androidManifestFile&gt;</span>${project.basedir}/AndroidManifest.xml<span class="nt">&lt;/androidManifestFile&gt;</span>
        <span class="nt">&lt;assetsDirectory&gt;</span>${project.basedir}/src/main/android/assets<span class="nt">&lt;/assetsDirectory&gt;</span>
        <span class="nt">&lt;resourceDirectory&gt;</span>${project.basedir}/src/main/android/res<span class="nt">&lt;/resourceDirectory&gt;</span>
        <span class="nt">&lt;resourceOverlayDirectory&gt;</span>${profileResources}<span class="nt">&lt;/resourceOverlayDirectory&gt;</span>
        <span class="nt">&lt;sdk&gt;</span>
            <span class="nt">&lt;path&gt;</span>${env.ANDROID_HOME}<span class="nt">&lt;/path&gt;</span>
            <span class="nt">&lt;platform&gt;</span>8<span class="nt">&lt;/platform&gt;</span>
        <span class="nt">&lt;/sdk&gt;</span>
        <span class="nt">&lt;deleteConflictingFiles&gt;</span>true<span class="nt">&lt;/deleteConflictingFiles&gt;</span>
        <span class="nt">&lt;undeployBeforeDeploy&gt;</span>true<span class="nt">&lt;/undeployBeforeDeploy&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre>
<pre class="highlight xml"><span class="nt">&lt;profile&gt;</span>
    <span class="nt">&lt;id&gt;</span>profile1<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;activation&gt;</span>
        <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
    <span class="nt">&lt;/activation&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;profileResources&gt;</span>${project.basedir}/src/main/profiles/profile1/res<span class="nt">&lt;/profileResources&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;profile&gt;</span>
    <span class="nt">&lt;id&gt;</span>profile2<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;profileResources&gt;</span>${project.basedir}/src/main/profiles/profile2/res<span class="nt">&lt;/profileResources&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/profile&gt;</span>
</pre>

<p>この設定では、${project.basedir}/src/main/android以下にassetsディレクトリとresディレクトリを置いて、${project.basedir}/src/main/profiles以下にあるプロファイルごとの設定でresを上書きしています。</p>

<p>例えば以下のようなディレクトリ構成だったとして、XML設定ファイルを環境ごとに切り替える場合を考えてみます。</p>

<p><a href="/images/2011/10/sshot-1.jpg"><img src="/static/images/2011/10/sshot-1-222x300.jpg" alt="" title="sshot-1" width="222" height="300" class="aligncenter size-medium wp-image-58369"/></a></p>

<p>resourceDirectory(上の設定例では${project.basedir}/src/main/android/res)にはデフォルトでdrawable-hdpi、drawable-ldpi、drawable-mdpi、layout、valuesが作られています。そこにさらにXMLディレクトリを追加しました。<br/>
そしてresourceOverlayDirectory(上の設定例では${project.basedir}/src/main/profiles以下のres)にはXMLディレクトリだけを作成しました。<br/>
今回はresourceDirectoryにはsample01.xml、sample02.xmlの2ファイル、resourceOverlayDirectoryにはsample02.xml、sample03.xmlの2ファイルを配置しました。コンパイル後、sample02.xmlが上書きされ、sample03.xmlがコピーされるはずです。</p>

<p>なおresourceDirectoryディレクトリを直接切り替えることも可能ですが、その場合は全てのプロファイルに全てのリソースを持たないといけないため、プロファイルで異なる差分部分だけをresourceOverlayDirectoryで上書きします。</p>

<h2>結合</h2>

<p>それではコンパイルしてみましょう。以下のコマンドで各プロファイルに対応したapkを作成します。</p>
<pre class="highlight plaintext">$ mvn clean install -P プロファイル名
</pre>

<p>コンパイルが無事終わると、リソースはapkファイルに固められます。この時、XMLファイルはAndroid XML Binary形式に変換されるので注意してください(CLASSファイルもDalvik VM用にdex形式に変換される)。<br/>
apkはただのzipファイルなのでアーカイバで中を見ることが出来ます。中を見てみましょう。</p>

<p><a href="/images/2011/10/sshot-2.jpg"><img src="/static/images/2011/10/sshot-2-300x166.jpg" alt="" title="sshot-2" width="300" height="166" class="aligncenter size-medium wp-image-58241"/></a></p>

<p>正しく結合されました。</p>

<p>res以下にvaluesが見当たりませんが、resources.arscに格納されています。<br/>
ちなみにvaluesとは別にvalues-jpやvalues-enなどvalues-xx形式で言語別の設定をすることも出来ます。xxにはISO 639-1に定義されているものが使えます。<br/>
<a href="http://www.loc.gov/standards/iso639-2/php/code_list.php" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.loc.gov']);">Codes for the Representation of Names of Languages</a></p>

  <hr/>

    <p><a href="../3/">Next page</a></p>

          </div>
          <div class="col-lg-4">
            <div class="well">
              <h4>Recent Articles</h4>
              <ol class="list-unstyled">
                  <li><a href="../../archives/2014/04/10/takezoux2.html">ScalaとRubyどっちがいいの？</a> <span>2014-04-10</span></li>
                  <li><a href="../../archives/2014/03/08/takezoux2.html">3分で掴むScalaのコツ</a> <span>2014-03-08</span></li>
                  <li><a href="../../archives/2013/12/08/takezoux2.html">ScalaのParserCombinator実践入門＋</a> <span>2013-12-08</span></li>
                  <li><a href="../../archives/2013/06/21/takezoux2.html">UnityでWebSocketを使ってチャット -Playと一緒-</a> <span>2013-06-21</span></li>
                  <li><a href="../../archives/2013/01/30/k_ryoko.html">GTE Git branching model</a> <span>2013-01-30</span></li>
                  <li><a href="../../archives/2012/12/19/takezoux2.html">scala 2.10のreflectionでorg.apache.commons.beanutils.PropertyUtilsっぽいものを作ってみた</a> <span>2012-12-19</span></li>
                  <li><a href="../../archives/2012/09/05/yyuu.html">rbenv – ruby + python => pyenv</a> <span>2012-09-05</span></li>
                  <li><a href="../../archives/2012/08/02/takezoux2.html">Scala勉強会 in 本郷始めました。</a> <span>2012-08-02</span></li>
                  <li><a href="../../archives/2012/07/31/kohashi.html">enchant.jsでjsファイルを必要なときにロードする</a> <span>2012-07-31</span></li>
                  <li><a href="../../archives/2012/07/30/takezoux2.html">javaのExceptionのコストについて</a> <span>2012-07-30</span></li>
              </ol>
            </div>
            <div class="well">
              <h4>By Year</h4>
              <ol class="list-unstyled">
                  <li><a href="../../archives/2014.html">2014 (2)</a></li>
                  <li><a href="../../archives/2013.html">2013 (3)</a></li>
                  <li><a href="../../archives/2012.html">2012 (10)</a></li>
                  <li><a href="../../archives/2011.html">2011 (11)</a></li>
                  <li><a href="../../archives/2010.html">2010 (3)</a></li>
              </ol>
            </div>
            <div class="well">
              <h4>Tags</h4>
              <div class="row">
                <div class="col-lg-6">
                  <ul class="list-unstyled">
                      <li><a href="../../archives/tags/scala.html">Scala (10)</a></li>
                      <li><a href="../../archives/tags/maven.html">maven (4)</a></li>
                      <li><a href="../../archives/tags/sbt.html">sbt (2)</a></li>
                      <li><a href="../../archives/tags/nodejs.html">nodejs (1)</a></li>
                      <li><a href="../../archives/tags/tips.html">Tips (4)</a></li>
                      <li><a href="../../archives/tags/android.html">Android (3)</a></li>
                      <li><a href="../../archives/tags/javascript.html">JavaScript (4)</a></li>
                      <li><a href="../../archives/tags/ios.html">iOS (3)</a></li>
                      <li><a href="../../archives/tags/play-framework.html">play framework (3)</a></li>
                      <li><a href="../../archives/tags/git.html">git (1)</a></li>
                  </ul>
                </div>
                <div class="col-lg-6">
                  <ul class="list-unstyled">
                      <li><a href="../../archives/tags/uncategorized.html">Uncategorized (4)</a></li>
                      <li><a href="../../archives/tags/lua.html">Lua (1)</a></li>
                      <li><a href="../../archives/tags/lightning.html">Lightning (1)</a></li>
                      <li><a href="../../archives/tags/python.html">Python (1)</a></li>
                      <li><a href="../../archives/tags/c.html">C# (1)</a></li>
                      <li><a href="../../archives/tags/unity.html">Unity (1)</a></li>
                      <li><a href="../../archives/tags/css.html">css (1)</a></li>
                      <li><a href="../../archives/tags/java.html">Java (2)</a></li>
                      <li><a href="../../archives/tags/jetty.html">jetty (1)</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="well">
              <h4>Authors</h4>
              <div class="row">
                <div class="col-lg-6">
                  <ul class="list-unstyled">
                      <li><a href="../../archives/authors/takezoux2.html">takezoux2</a></li>
                      <li><a href="../../archives/authors/yyuu.html">yyuu</a></li>
                      <li><a href="../../archives/authors/kohashi.html">kohashi</a></li>
                      <li><a href="../../archives/authors/k_ryoko.html">k_ryoko</a></li>
                      <li><a href="../../archives/authors/ta2.html">ta2</a></li>
                      <li><a href="../../archives/authors/y_okaya.html">y_okaya</a></li>
                  </ul>
                </div>
                <div class="col-lg-6">
                  <ul class="list-unstyled">
                      <li><a href="../../archives/authors/y_okaya.html">y_okaya</a></li>
                      <li><a href="../../archives/authors/arikui.html">arikui</a></li>
                      <li><a href="../../archives/authors/yamauchi.html">yamauchi</a></li>
                      <li><a href="../../archives/authors/g_enrique.html">g_enrique</a></li>
                      <li><a href="../../archives/authors/h_ninomiya.html">h_ninomiya</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright &copy; Geisha Tokyo Entertainment, Inc. 2010-</p>
        </div>
      </div>
    </footer>
  </body>
</html>
